# Документация API

Базовый URL: `http://localhost:8000`

## Общие эндпоинты

### Проверка статуса (Health Check)
*   **Метод**: `GET`
*   **Путь**: `/health`
*   **Описание**: Проверяет, работает ли сервер.
*   **Ответ**:
    ```json
    {
      "status": "ok"
    }
    ```

---

## Работа с документами

### 1. Загрузка документа
*   **Метод**: `POST`
*   **Путь**: `/documents/upload`
*   **Описание**: Загружает файл и запускает процесс его индексации в фоне.
*   **Тело запроса (Multipart)**:
    *   `file`: Файл (binary). Поддерживаются `.txt`, `.pdf`.
*   **Ответ (200 OK)**:
    ```json
    {
      "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "filename": "instruction.pdf",
      "status": "uploaded",
      "created_at": "2024-12-31T12:00:00Z",
      "error": null
    }
    ```

### 2. Получение списка документов
*   **Метод**: `GET`
*   **Путь**: `/documents`
*   **Описание**: Возвращает список всех загруженных файлов с их текущим статусом.
*   **Ответ (200 OK)**:
    ```json
    [
      {
        "id": "uuid...",
        "filename": "doc1.txt",
        "status": "indexed",
        "created_at": "timestamp...",
        "error": null
      },
      ...
    ]
    ```

### 3. Удаление документа
*   **Метод**: `DELETE`
*   **Путь**: `/documents/{source_id}`
*   **Описание**: Удаляет документ из таблицы `sources` и каскадно удаляет все его чанки из таблицы `chunks`.
*   **Параметры пути**:
    *   `source_id`: UUID документа.
*   **Ответ (200 OK)**:
    ```json
    {
      "message": "Deleted"
    }
    ```

---

## Чат и Поиск

### Задать вопрос (Chat)
*   **Метод**: `POST`
*   **Путь**: `/chat`
*   **Описание**: Основной эндпоинт для RAG. Ищет информацию в документах и генерирует ответ.
*   **Тело запроса (JSON)**:
    ```json
    {
      "question": "Как запустить проект локально?",
      "source_ids": [] // Опционально: список UUID документов для фильтрации поиска. Если пусто - ищет по всем.
    }
    ```
*   **Ответ (200 OK)**:
    ```json
    {
      "answer": "Для запуска проекта локально выполните команду...",
      "sources": [
        {
          "source_id": "uuid...",
          "filename": "readme.txt",
          "chunk_index": 0,
          "similarity": 0.89,
          "chunk_text": "..."
        }
      ]
    }
    ```
    *   `answer`: Сгенерированный ответ модели.
    *   `sources`: Список наиболее релевантных фрагментов, использованных для ответа.
